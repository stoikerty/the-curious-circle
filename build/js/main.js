document.addEventListener("DOMContentLoaded",function(){!function(t){function i(t,i,e){t.style["-webkit-transform"]="translate("+i+"px, "+e+"px)",t.style["-moz-transform"]="translate("+i+"px, "+e+"px)",t.style["-ms-transform"]="translate("+i+"px, "+e+"px)",t.style["-o-transform"]="translate("+i+"px, "+e+"px)",t.style.transform="translate("+i+"px, "+e+"px)"}function e(t){return"[object Number]"===toString.call(t)}function s(t,s,o){return this._gridSize=t,this._worldSize=s,this._worldElement=o,this._gridCells=this._worldElement.querySelector(".grid-cells"),this._gridElement=this._gridCells.querySelector(".cell"),this._robotElement=this._worldElement.querySelector(".robot"),this._pointerElement=this._robotElement.querySelector(".pointer"),this._orientation=null,this._x=null,this._y=null,this._dead=null,this._scentedPositions=[],this._init=function(){var t=this;t._robotElement.classList.add("is-dead"),t._dead=!0,setTimeout(function(){t._moveTo(0,0),t._turn("north"),setTimeout(function(){t._robotElement.classList.remove("is-dead"),t._dead=!1},200)},200)},this._moveForward=function(){"north"==this._orientation&&this._move(0,1),"east"==this._orientation&&this._move(1,0),"south"==this._orientation&&this._move(0,-1),"west"==this._orientation&&this._move(-1,0)},this._turn=function(t){var i="";this._pointerElement.classList.remove("north","east","south","west"),"left"==t&&("north"==this._orientation&&(i="west"),"east"==this._orientation&&(i="north"),"south"==this._orientation&&(i="east"),"west"==this._orientation&&(i="south")),"right"==t&&("north"==this._orientation&&(i="east"),"east"==this._orientation&&(i="south"),"south"==this._orientation&&(i="west"),"west"==this._orientation&&(i="north")),["north","east","south","west"].indexOf(t)>-1&&(i=t),this._orientation=i,this._pointerElement.classList.add(this._orientation)},this._move=function(t,i){this._moveTo(this._x+t,this._y+i)},this._moveTo=function(t,s){var o=this;if(o._robotElement.classList.add("is-moving"),setTimeout(function(){o._robotElement.classList.remove("is-moving")},200),t>this._worldSize||0>t||s>this._worldSize||0>s){e(t)&&e(s)||(e(t)&&(this._checkOrientation(this._x,t,null,null),this._x=Math.min(Math.max(t,0),this._worldSize)),e(s)&&(this._checkOrientation(null,null,this._y,s),this._y=Math.min(Math.max(s,0),this._worldSize)));var n={orientation:this._orientation,x:Math.min(Math.max(this._x,0),this._worldSize),y:Math.min(Math.max(this._y,0),this._worldSize)},r=this._isPositionScented(n.orientation,n.x,n.y);r?(i(this._robotElement,this._x*this._gridSize,-this._y*this._gridSize),r.classList.add("is-stepped-on"),o._robotElement.classList.remove("is-moving"),o._robotElement.classList.add("is-not-moving"),setTimeout(function(){r.classList.remove("is-stepped-on"),o._robotElement.classList.remove("is-not-moving")},400)):(this._addScentedPosition(n.orientation,n.x,n.y),this._init())}else e(t)&&(this._x=t),e(s)&&(this._y=s),i(this._robotElement,this._x*this._gridSize,-this._y*this._gridSize)},this._checkOrientation=function(t,i,e,s){t&&i&&i>t?this._turn("east"):this._turn("west"),e&&s&&s>e?this._turn("south"):this._turn("north")},this._isPositionScented=function(t,i,e){var s=!1,o=!1;return this._scentedPositions.forEach(function(n){n.x==i&&n.y==e&&(s&&n.orientation==t?o=n.cell:s||(o=n.cell))}),o},this._addScentedPosition=function(t,e,s){var o=this._gridElement.cloneNode(!0);i(o,e*this._gridSize,-s*this._gridSize),setTimeout(function(){o.classList.add("is-active")},200),this._scentedPositions.push({orientation:t,x:e,y:s,cell:o}),this._gridCells.appendChild(o)},this.isDead=function(){return this._dead},this.moveForward=function(){this._moveForward()},this.turnLeft=function(){this._turn("left")},this.turnRight=function(){this._turn("right")},this.orientation=function(t){this._turn(t)},this.moveTo=function(t,i,e){t?(this._moveTo(i,null),this._dead||this._moveTo(null,e)):this._moveTo(i,e)},this._init()}function o(t,i){for(var e=0;e<t.length;e++)if(t[e]){var s=t[e];setTimeout(function(t){"finish"!==t&&"-"!==t?x.processText(t):"-"==t?d.innerHTML=d.innerHTML+"<br>":(d.innerHTML=d.innerHTML+"<br><br> { Test Data completed } <br>",x.processText("0 0 N"))}.bind(this,s),i*e)}}function n(t){t=t||window.event,"38"==t.keyCode?(L.click(),L.classList.add("is-clicked"),setTimeout(function(){L.classList.remove("is-clicked")},200)):"37"==t.keyCode?(_.click(),_.classList.add("is-clicked"),setTimeout(function(){_.classList.remove("is-clicked")},200)):"39"==t.keyCode&&(f.click(),f.classList.add("is-clicked"),setTimeout(function(){f.classList.remove("is-clicked")},200))}function r(){this.processText=function(t){var i=t.split(" ");if(parseInt(t[0],10)>=0){for(var e,s,o="",n=0;n<i.length;n++)if(2>n){var r=Math.min(parseInt(i[n],10),50);0==n&&(e=r),1==n&&(s=r)}else if(2==n){var a=i[n][0].toUpperCase();"N"===a&&(o="north"),"E"===a&&(o="east"),"W"===a&&(o="west"),"S"===a&&(o="south")}this.processPosition(e,s,o)}else this.processInstructions(t)},this.processPosition=function(i,e,s){""!==d.innerHTML&&(d.innerHTML=d.innerHTML+"<br>"),d.appendChild(t.createTextNode(i+" "+e+" "+(s[0]?s[0].toUpperCase():""))),S.moveTo(!0,i,e),S.isDead()?d.innerHTML=d.innerHTML+" LOST":s&&"none"!==s&&S.orientation(s),d.scrollTop=d.scrollHeight},this.processInstructions=function(i){for(var e="",s=0;s<i.length;s++){var o=i[s].toUpperCase();if("F"===o&&S.moveForward(),"L"===o&&S.turnLeft(),"R"===o&&S.turnRight(),e+=o,S.isDead()){e+=" LOST";break}}""!==d.innerHTML&&(d.innerHTML=d.innerHTML+"<br>"),d.appendChild(t.createTextNode(e.toUpperCase())),d.scrollTop=d.scrollHeight}}function a(){this.position={x:!1,y:!1,orientation:!1},this.toggleX=function(){this.position.x=!this.position.x,this.position.y=!1,this.position.orientation=!1,this.showType()},this.toggleY=function(){this.position.x=!1,this.position.y=!this.position.y,this.position.orientation=!1,this.showType()},this.toggleOrientation=function(){this.position.x=!1,this.position.y=!1,this.position.orientation=!this.position.orientation,this.showType()},this.showType=function(){this.position.x?(b.x.classList.add("is-active"),u.classList.add("number-mode")):(b.x.classList.remove("is-active"),u.classList.contains("number-mode")&&u.classList.remove("number-mode")),this.position.y?(b.y.classList.add("is-active"),u.classList.add("number-mode")):(b.y.classList.remove("is-active"),!this.position.x&&u.classList.contains("number-mode")&&u.classList.remove("number-mode")),this.position.orientation?(b.orientation.classList.add("is-active"),u.classList.add("orientation-mode")):(b.orientation.classList.remove("is-active"),u.classList.contains("orientation-mode")&&u.classList.remove("orientation-mode")),u.classList.contains("number-mode")||u.classList.contains("orientation-mode")?u.classList.contains("disabled-mode")&&u.classList.remove("disabled-mode"):u.classList.add("disabled-mode")},this.enterValue=function(t,i,e){if(!u.classList.contains("disabled-mode")){var s=u.querySelector(".position .is-active");if(e||this.position.orientation){if(!e&&this.position.orientation&&i.length>2)s.innerHTML=i,s.classList.add("is-modified");else if(e)if(s.classList.contains("is-modified")){s.disabled=!0,this.position.orientation||(s.innerHTML=Math.min(parseInt(s.innerHTML,10),50)),s.classList.remove("is-active"),this.position={x:!1,y:!1,orientation:!1},this.showType();var o=u.querySelectorAll(".position button:disabled");if(3==o.length){for(var n=0;n<o.length;n++)o[n].disabled=!1;u.classList.add("is-resetting"),setTimeout(function(){x.processPosition(parseInt(b.x.innerHTML,10),parseInt(b.y.innerHTML,10),b.orientation.innerHTML),b.x.innerHTML="X",b.y.innerHTML="Y",b.orientation.innerHTML="orientation",u.classList.remove("is-resetting")},700)}}else this.position={x:!1,y:!1,orientation:!1},this.showType()}else parseInt(s.innerHTML,10)>=0||(s.innerHTML=""),s.innerHTML=s.innerHTML+t,s.classList.add("is-modified")}}}var c=t.querySelector(".world-grid"),l=t.querySelector(".instructions"),h=t.querySelector(".command-input"),d=t.querySelector(".history"),u=t.querySelector(".numpad"),m=t.querySelector(".info-container"),p=t.querySelector(".info-container .toggle"),L=l.querySelector(".forward"),_=l.querySelector(".left"),f=l.querySelector(".right"),v=t.querySelector(".test-sample"),g=t.querySelector(".dance"),y=t.querySelector(".robot").offsetWidth,T=Math.floor(c.offsetWidth/y)-1,S=new s(y,T,c);p.addEventListener("click",function(t){t.stopPropagation(),m.classList.toggle("is-active"),c.classList.toggle("is-active"),h.classList.toggle("is-active")}),L.addEventListener("click",function(t){t.stopPropagation(),x.processInstructions("F")}),_.addEventListener("click",function(t){t.stopPropagation(),x.processInstructions("L")}),f.addEventListener("click",function(t){t.stopPropagation(),x.processInstructions("R")}),v.addEventListener("click",function(t){t.stopPropagation();var i=["5 3","1 1 E","RFRFRFRF","-","3 2 N","FRRFLLFFRRFLL","-","0 3 W","LLFFFLFLFL",null,"finish"];o(i,600)}),g.addEventListener("click",function(t){t.stopPropagation();var i=["0 -1","1 -1","2 -1","3 -1","4 -1","5 -1","6 -1","7 -1","8 -1","9 -1","10 -1","11 -1","12 -1","13 -1","0 50","1 50","2 50","3 50","4 50","5 50","6 50","7 50","8 50","9 50","10 50","11 50","12 50","13 50","-","6 3 E","6 3 S","6 3 N","6 3 W","6 3 E","6 3 N","6 3 N","5 3 S","F","F","F","F","L","L","F","F","F","R","R","R","R","R","R","L","L","L","L","L","L","6 12 S","F","F","F","F","R","F","F","F","F","L","R","R","9 5 E","9 5 S","9 5 N","9 5 W","12 4 E","12 4 N","12 4 W","12 4 N","12 4 S",null,"finish"];o(i,600)}),t.onkeydown=n,h.querySelector(".current-input").addEventListener("keydown",function(t){t.stopPropagation();var i=t.target.value;13==t.keyCode&&(t.target.value="",x.processText(i))});var x=new r,b={};b.x=u.querySelector(".position .x"),b.y=u.querySelector(".position .y"),b.orientation=u.querySelector(".position .orientation"),b.x.addEventListener("click",function(t){t.stopPropagation(),M.toggleX()}),b.y.addEventListener("click",function(t){t.stopPropagation(),M.toggleY()}),b.orientation.addEventListener("click",function(t){t.stopPropagation(),M.toggleOrientation()});for(var w=u.querySelectorAll(".numbers button"),E=0;E<w.length;E++)w[E].addEventListener("click",function(t){t.stopPropagation();var i=t.target.classList.contains("confirm");M.enterValue(t.target.getAttribute("data-number"),t.target.getAttribute("data-orientation"),i)});var M=new a}(document)});